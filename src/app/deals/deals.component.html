<app-back-to-top></app-back-to-top>
<div *ngIf="!getLoadingScreenService().isLoading() && areCurrenciesReceived() && areStoresReceived()" class="container-custom deals">
	<h3 class="text-center">{{ 'totalDeals' | translate }}: {{ getTotalGamesCount() }}</h3>
	<h4 class="text-center">{{ 'searchResults' | translate }}: {{ getFilteredGamesCount() }}</h4>
	<div class="mt-3 mb-2">
		<button type="button" (click)="getFilterService().toggleFilter()">
			<span *ngIf="!isFilterOpened();else elseBlock">
				<fa name="plus"></fa>{{ 'showFilters' | translate }}
			</span>
			<ng-template #elseBlock>
				<fa name="minus"></fa>{{ 'hideFilters' | translate }}
			</ng-template>
		</button>
	</div>
	<form #filterForm="ngForm" (ngSubmit)="sortTable()">
		<app-filter *ngIf="isFilterOpened()" (filtered)="sortTable($event)"></app-filter>
	</form>
	<div class="table-responsive">
		<form #filterForm="ngForm" (ngSubmit)="sortTable()">
			<table class="table table-hover">
				<thead>
					<tr>
						<th title="Rendezés név szerint" (click)="sortTable('name')">{{ 'name' | translate }}
							<span>{{ checkSorting('name') }}</span>
						</th>
						<th title="Rendezés akciós ár szerint" (click)="sortTable('specialPrice')" class="text-center">{{ 'currentPrice'| translate }}
							<span>{{ checkSorting('specialPrice') }}</span>
						</th>
						<th title="Rendezés eredeti ár szerint" (click)="sortTable('originalPrice')" class="text-center">
							{{ 'originalPrice' | translate }}
							<span>{{ checkSorting('originalPrice') }}</span>
						</th>
						<th title="Rendezés kedvezmény szerint" (click)="sortTable('discountPercent')" class="text-center">{{ 'discount' | translate }}
							<span>{{ checkSorting('discountPercent') }}</span>
						</th>
						<th title="Rendezés felhasználói értékelés szerint" (click)="sortTable('totalRating')" class="text-center">{{ 'rating' | translate }}
							<span>{{ checkSorting('totalRating') }}</span>
						</th>
					</tr>
				</thead>
				<tbody>
					<tr *ngFor="let game of getUniqueGames(getUnwindedGamesList())" (click)="showAllStores(game)">
						<td id="productName">
							<div>{{ game.name }}</div>
							<div id="genres">{{ game.genres }}</div>
						</td>
						<td id="specialPrice" class="text-center">
							{{ currencyConverter(game.stores.specialPrice,'EUR',getFilterService().filter.currency).toFixed(getFilterService().filter.decimalPlaces) }} {{ getFilterService().filter.symbol}}
						</td>
						<td id="originalPrice" class="text-center">
							{{ currencyConverter(game.stores.originalPrice,'EUR',getFilterService().filter.currency).toFixed(getFilterService().filter.decimalPlaces) }} {{ getFilterService().filter.symbol}}
						</td>
						<td id="discountPercent" class="text-center">
							<span>-{{ game.stores.discountPercent }} %</span>
						</td>
						<td id="metascore" class="text-center">
							<span class="metascore rated" *ngIf="game.totalRating;else elseBlock">
								{{ game.totalRating | number: '1.0-0' }}
							</span>
							<ng-template #elseBlock>
								<span class="metascore tba" title="besorolás alatt">TBA</span>
							</ng-template>
						</td>
					</tr>
				</tbody>
			</table>
		</form>
	</div>
	<button type="button" *ngIf="numberOfGamesLeft()>0" class="btn-block" (click)="showMore()">
		{{ 'showNextResults' | translate: {gamesPerRequest:getGamesPerRequest()} }}
	</button>
</div>
<app-game-details *ngIf="selectedGame" [selectedGame]="selectedGame" (close)="onClose()"></app-game-details>