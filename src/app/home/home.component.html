<div [class.loadingImages]="loadingImages">
	<div class="news-slideshow">
		<div class="news-main">
			<div class="row">
				<div class="col-4">
					<div class="news-container">
						<div class="news-description text-center" [ngClass]="{'fadeIn':fadeIn}">
							<h3>{{titles[index]}} {{ 'sale' | translate }}</h3>
							<p>{{ 'endOfDeal' | translate }}: {{months[endOfOffer[index].getMonth()]}} {{endOfOffer[index].getDate()}}.</p>
							<button (click)="goToExternalUrl(links[index])">{{ 'letssee' | translate}}</button>
						</div>
					</div>
					<span class="custom-badge">
						<span class="custom-badge-text" [ngClass]="{'fadeIn':fadeIn}">{{discounts[index]}}</span>
					</span>
				</div>
				<div class="col-8">
					<div class="news-image">
						<img [ngClass]="{'fadeIn':fadeIn}" [src]='"/assets/"+images[index]+".jpg"' alt="{{titles[index]}}" (loaded)="loadingImages=false" width="100%">
					</div>
				</div>
				<span class="pager pager-left" (click)="deleteClass();previous()">&lt;</span>
				<span class="pager pager-right" (click)="deleteClass();next()">&gt;</span>
			</div>
		</div>
		<div class="nav-buttons text-center">
			<span *ngFor="let img of images;index as i" [class.active]="index==i" [class.passed]="index>i" (click)="changeNews(i)"></span>
		</div>
	</div>
	<div *ngIf="!getUserService().isAuthenticated();else elseBlock" class="text-center m-2 p-3">
		<h4>{{ 'shouldLogin' | translate }}</h4>
		<button [routerLink]="['/login']">{{ 'login' | translate }}</button>
	</div>
	<ng-template #elseBlock>
		<div *ngIf="numberOfWatchedGames>0">
			<div id="recommendedGames" class="mt-5">
				<div class="container-custom fixed deals">
					<h2>{{ 'recommendedGames' | translate }}</h2>
					<div class="table-responsive">
						<table class="table table-hover table-dark">
							<thead>
								<tr>
									<th></th>
									<th>{{ 'name' | translate }}</th>
									<th class="text-center">{{ 'currentPrice' | translate }}</th>
									<th class="text-center">{{ 'originalPrice' | translate }}</th>
									<th class="text-center">{{ 'discount' | translate }}</th>
									<th class="text-center">Metascore</th>
								</tr>
							</thead>
							<tbody>
								<tr *ngFor="let game of getRecommendedGames()" (click)="showAllStores(game)">
									<td id="productImage">
										<img *ngIf="game.stores[0].image;else noimageBlock" src="{{ game.stores[0].image }}" alt="{{ game.name }}">
										<ng-template #noimageBlock>
											<span class="noimage"><fa name="photo"></fa></span>
										</ng-template>
									</td>
									<td id="productName">
										{{ game.name }}
									</td>
									<td id="specialPrice" class="text-center">{{ currencyConverter(getCheapestStore(game).specialPrice,'EUR',getFilterService().filter.currency).toFixed(getFilterService().filter.decimalPlaces) }} {{ getFilterService().filter.symbol}}</td>
									<td id="originalPrice" class="text-center">{{ currencyConverter(getCheapestStore(game).originalPrice,'EUR',getFilterService().filter.currency).toFixed(getFilterService().filter.decimalPlaces) }} {{ getFilterService().filter.symbol}}</td>
									<td id="discountPercent" class="text-center">
										<span>-{{ getCheapestStore(game).discountPercent }} %</span>
									</td>
									<td id="metascore" class="text-center">
										<span class="rated" *ngIf="game.metascore;else elseBlock">
											{{ game.metascore }}
										</span>
										<ng-template #elseBlock>
											<span class="tba" title="besorolás alatt">TBA</span>
										</ng-template>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
			<div id="watchedGames">
				<div class="d-flex justify-content-between mt-3">
					<h2>{{ 'watchHistory' | translate }}</h2>
					<div class="d-inline-block">
						<button (click)="showViewedGenres=!showViewedGenres" class="mr-2">
							<span *ngIf="!showViewedGenres;else elseBlock">{{ 'watchedGenresShow' | translate }}</span>
							<ng-template #elseBlock>{{ 'watchedGenresHide' | translate }}</ng-template>
						</button>
						<button (click)="deleteGameHistory()">{{ 'watchHistoryDelete' | translate }}</button>
					</div>
				</div>
				<div class="container-custom fixed deals">
					<div *ngIf="showViewedGenres" id="chart-container">
						<app-chart [genreStatistics]=genreStatistics [uniqueWatchedGenres]=uniqueWatchedGenres></app-chart>
					</div>
					<div class="table-responsive">
						<table class="table table-hover table-dark">
							<thead>
								<th></th>
								<th>{{ 'name' | translate }}</th>
								<th class="text-center">{{ 'currentPrice' | translate }}</th>
								<th class="text-center">{{ 'originalPrice' | translate }}</th>
								<th class="text-center">{{ 'discount' | translate }}</th>
								<th class="text-center">Metascore</th>
							</thead>
							<tbody>
								<tr *ngFor="let game of getGamesData()" (click)="showAllStores(game)">
									<td id="productImage">
										<img *ngIf="game.stores[0].image;else noimageBlock" src="{{ game.stores[0].image }}" alt="{{ game.name }}">
										<ng-template #noimageBlock>
											<span class="noimage"><fa name="photo"></fa></span>
										</ng-template>
									</td>
									<td id="productName">
										<a href="{{ getCheapestStore(game).linkToGame }}" target="_blank">{{ game.name }}</a>
									</td>
									<td id="specialPrice" class="text-center">{{ currencyConverter(getCheapestStore(game).specialPrice,'EUR',getFilterService().filter.currency).toFixed(getFilterService().filter.decimalPlaces) }} {{ getFilterService().filter.symbol}}</td>
									<td id="originalPrice" class="text-center">{{ currencyConverter(getCheapestStore(game).originalPrice,'EUR',getFilterService().filter.currency).toFixed(getFilterService().filter.decimalPlaces) }} {{ getFilterService().filter.symbol}}</td>
									<td id="discountPercent" class="text-center">
										<span>-{{ getCheapestStore(game).discountPercent }} %</span>
									</td>
									<td id="metascore" class="text-center">
										<span class="rated" *ngIf="game.metascore;else elseBlock">
											{{ game.metascore }}
										</span>
										<ng-template #elseBlock>
											<span class="tba" title="besorolás alatt">TBA</span>
										</ng-template>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
		<app-game-details *ngIf="selectedGame" [selectedGame]="selectedGame" (close)="onClose()"></app-game-details>
	</ng-template>
</div>